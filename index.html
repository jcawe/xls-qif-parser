<!DOCTYPE html>
<html lang="en">

<head>
  <title>XLS QIF CONVERTER</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-rc.2/css/materialize.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-rc.2/js/materialize.min.js"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body>
  <nav>
    <div class="nav-wrapper">
      <a href="#" class="brand-logo center">XLS QIF Converter</a>
    </div>
  </nav>
  <div class="center">
    <form>
      <div id="form-buttons" class="scale-transition">
        <a href="#" class="waves-effect waves-light btn-large" onclick="selectExcel()">Select excel file...</a>
        <a id="btnQif" href="#" class="waves-effect waves-light btn-large disabled" onclick="selectQif()">Select save location...</a>
        <button id="btnConvert" type="submit" class="waves-effect waves-light btn-large disabled">
          Convert
          <i class="material-icons right">autorenew</i>
        </button>
      </div>
    </form>
    <div id="loader" class="preloader-wrapper big">
      <div class="spinner-layer spinner-blue-only">
        <div class="circle-clipper left">
          <div class="circle"></div>
        </div>
        <div class="gap-patch">
          <div class="circle"></div>
        </div>
        <div class="circle-clipper right">
          <div class="circle"></div>
        </div>
      </div>
    </div>
    <div id="error" class="card-panel center red darken-1 hide scale-transition scale-out white-text">
      <h2 class="card-title">
        <i class="medium material-icons">error</i>ERROR!</h2>
      <p id="errorText"></p>
      <a onclick="reload()" class="btn-floating pulse red">
        <i class="material-icons">refresh</i>
      </a>
    </div>
    <div id="success" class="card-panel center teal darken-1 hide scale-transition scale-out white-text">
      <h2 class="card-title">
        <i class="medium material-icons">check</i>SUCCESS!</h2>
      <p>File converted successfully!</p>
      <a onclick="reload()" class="btn-floating pulse">
        <i class="material-icons">refresh</i>
      </a>
    </div>
  </div>
  <script>
    const electron = require('electron');
    const { ipcRenderer } = electron;
    const form = document.getElementsByTagName("form")[0];
    const btnQif = document.getElementById("btnQif");
    const btnConvert = document.getElementById("btnConvert");
    const loader = document.getElementById("loader");
    const formButtons = document.getElementById("form-buttons");

    form.addEventListener("submit", convert, false);

    function selectExcel() {
      ipcRenderer.send("btn:selectExcel");
    }

    function selectQif() {
      ipcRenderer.send("btn:selectQif");
    }

    function convert(e) {
      e.preventDefault();
      formButtons.classList.add("scale-out");
      loader.classList.add("active");
      ipcRenderer.send("btn:convert");
    }

    ipcRenderer.on("path:excel", function (active) {
      activateButton(btnQif, active);
    });

    ipcRenderer.on("path:qif", function (active) {
      activateButton(btnConvert, active);
    });

    ipcRenderer.on("error", function (e, error) {
      document.getElementById("errorText").textContent = error;
      document.getElementById("error").classList.remove("hide");
      document.getElementById("error").classList.add("scale-in");
      loader.classList.remove("active");
    });

    ipcRenderer.on("success", function () {
      loader.classList.remove("active");
      document.getElementById("success").classList.remove("hide");
      document.getElementById("success").classList.add("scale-in");
    });

    function activateButton(button, active) {
      if (active) button.classList.remove("disabled");
      else button.classList.add("disabled");
    }

    function reload() {
      location.reload();
    }
  </script>
</body>

</html>